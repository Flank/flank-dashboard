name: Metrics Actions

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check-links-actions:
    name: Check Links Actions
    runs-on: macOS-latest
    timeout-minutes: 60
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 1
          ref: ${{ github.ref }}

      - uses: cedx/setup-dart@v2
        with:
          release-channel: beta
          version: 2.12.0-133.2.beta

      - name: Get dependencies
        run: pub get
        working-directory: scripts/links_checker/

      - name: Get all changed files
        id: files
        uses: jitterbit/get-changed-files@v1

      - name: Check links are pointing to master
        run: dart scripts/links_checker/bin/main.dart validate --paths='${{ steps.files.outputs.added_modified }} ${{ steps.files.outputs.renamed }}' --ignore-paths='.github/workflows/cla.yml'
