@startuml firestore_emulator_class_diagram

package test_driver {
    class FlutterWebDriver {
        - _args : DriverTestArguments
        - _processManager : ProcessManager
        + startDriverTests : Future<void>  
    }

    package arguments {
        package parser {
            class DriverTestArgumentsParser {
                - static const _useFirestoreEmulatorFlagName : String
                - static const _firestoreEmulatorPortOptionName : String
                - _configureParser() : void
                + parseArguments(List<String> args) : DriverTestArguments
            }
        } 

        package model {
            class DriverTestArguments {
                + firestoreEmulatorConfig : FirestoreEmulatorConfig
            }

            class FirestoreEmulatorConfig {
                + static useFirestoreEmulatorEnvVariableName : String
                + static firestorePortEnvVariableName : String

                + useEmulator : bool
                + port : String

                + factory fromEnvironment()
                + toMap() : Map<String, String>
            }
        }
    }

    package cli {
        package common.runner {
            abstract class ProcessRunner {}
        }

        package firebase {
            package model as firebase_model {
                class Emulator {
                    + static const firestore : Emulator
                }
            }

            package runner {
                abstract class FirebaseEmulatorRunner {
                    + port : int
                    + statusRequestUrl : String
                    + isAppStarted() : Future<void>
                }
                class FirestoreEmulatorRunner {
                    - _arguments : FirestoreEmulatorCommand
                    + args : List<String>
                    + executableName : String
                    + statusRequestUrl : String
                    + run(String workingDir) : Future<FirebaseProcess>
                }
            }

            package command {
                class StartEmulatorCommand {
                    + static const executableName : String
                    + emulatorsStart() : void
                    + only(Emulator emulator) : void
                    + inspectFunctions(int port) : void
                    + import(String directory) : void
                    + exportOnExit(String directory) : void
                }
            }

            package process {
                class FirebaseProcess {
                    + static start(FirestoreEmulatorCommand args, String workingDir) : Future<FirebaseProcess>
                }
            }
        }
    }

    package process_manager {
        class ProcessManager {
            + run() : Future<ProcessWrapper>
        }
    }
}

FlutterWebDriver --> DriverTestArguments : uses
DriverTestArguments -> FirestoreEmulatorConfig: uses
FlutterWebDriver --> ProcessManager : creates
ProcessManager --> FirestoreEmulatorRunner : runs
FirestoreEmulatorRunner --> StartEmulatorCommand : uses
FirestoreEmulatorRunner --> FirebaseProcess : starts
FirestoreEmulatorRunner ..|> FirebaseEmulatorRunner
FirebaseEmulatorRunner ..|> ProcessRunner
StartEmulatorCommand --> Emulator : uses
DriverTestArgumentsParser --> DriverTestArguments : provides

@enduml
