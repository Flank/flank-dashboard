@startuml

package github_actions <<Folder>> {

    package models <<Folder>> {

        abstract class Page<T> {
            +totalCount: int
            +page: int
            +pageCount: int
            +nextPage: String
            +values: List<T>
        }

        class WorkflowRunsPage<WorkflowRun> implements Page {
             +factory fromJson(Map<String, dynamic> json): WorkflowRunsPage
        }

        class WorkflowRunArtifactsPage<WorkflowRunArtifact> implements Page {
            +factory fromJson(Map<String, dynamic> json): WorkflowRunArtifactsPage
        }

        class WorkflowRun {
            +id: int
            +number: int
            +url: String
            +status: RunStatus
            +conclusion: RunConclusion
            +createdAt: DateTime

            +factory fromJson(Map<String, dynamic> json): WorkflowRun
            +toJson(): Map<String, dynamic>
            +listFromJson(List<dynamic> list): List<WorkflowRun>
        }

        class WorkflowRunArtifact {
            +id: int
            +name: String
            +downloadUrl: String

           +factory fromJson(Map<String, dynamic> json): WorkflowRunArtifact
           +toJson(): Map<String, dynamic>
           +listFromJson(List<dynamic> list): List<WorkflowRunArtifact>
        }

        class WorkflowRunDuration {
            +duration: Duration

            +factory fromJson(Map<String, dynamic> json): WorkflowRunDuration
            +toJson(): Map<String, dynamic>
        }


        enum RunStatus {
            queued
            inProgress
            completed
        }

        enum RunConclusion {
            success
            failure
            neutral
            cancelled
            skipped
            timedOut
            actionRequired
        }

    }

    package mappers <<Folder>> {
        class RunConclusionMapper {
            #map(String conclusion): RunConclusion
            #unmap(RunConclusion conclusion): String
        }

        class RunStatusMapper {
            #map(String status): RunStatus
            #unmap(RunStatus status): String
        }

    }


    class GithubActionsClient {
        +repositoryOwner: String
        +repositoryName: String
        +githubApiUrl: String
        +authorization: AuthorizationBase

        +getHeaders() : Map<String, String>
        +fetchWorkflowRuns(String workflowIdentifier, RunStatus status, int perPage, int page): Future<InteractionResult<WorkflowRunsPage>>
        +fetchNextRunsPage(WorkflowRunsPage page) : Future<InteractionResult<WorkflowRunsPage>>
        +fetchRunArtifacts(int runId, int perPage, int page): Future<InteractionResult<WorkflowRunArtifactsPage>>
        +fetchNextRunArtifactsPage(WorkflowRunArtifactsPage page) : Future<InteractionResult<WorkflowRunArtifactsPage>>
        +downloadRunArtifactZip(String url): Future<InteractionResult<UInt8List>>
        +fetchRunDuration(int runId): Future<InteractionResult<WorkflowRunDuration>>
        +close(): void
    }
}


WorkflowRunDuration <-- GithubActionsClient : uses
WorkflowRunsPage <-- GithubActionsClient : uses
WorkflowRunArtifactsPage <-- GithubActionsClient : uses
WorkflowRun <-- WorkflowRunsPage : uses
WorkflowRunArtifact <-- WorkflowRunArtifactsPage : uses
RunStatusMapper <-- GithubActionsClient : uses
RunConclusionMapper <-- GithubActionsClient : uses
RunConclusion <-- WorkflowRun : uses
RunStatus <-- WorkflowRun : uses

@enduml
